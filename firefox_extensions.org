* Appereance
  - Dark reader
  - Midnight Lizard
  - WikiWand
* Desktop Enviroment
  - Plasma Integration

* Privacy & AdBlock
** uBlock Orign
** Firefox Multi-Account Containers
* Curiosity
** WhatRuns
* Productivity
** Keybindings
*** Vimum
*** Surfingkeys
    settings.hintAlign = "left";
//Hints.characters = 'yuiophjklnm'; // for right hand
Hints.characters = 'fjdkrueisl'; // Home row without pinky baby
cmap('<Ctrl-j>', '<Tab>');
cmap('<Ctrl-k>', '<Shift-Tab>');


function alt_key(default_key){
    return ',' + default_key;
}

var vsc_keys = ['v', 's', 'd', 'h', 'l', 'r']; //Video Speed Controller Keys
var youtube_keys = ['i', 'f', 'c'];
var block_sites = ["netflix.com", "youtube.com", "seyredelim.com", "onepiece.gen.tr"];

//TODO
var block_for_vsc= new RegExp(block_sites.join("|"), "i");
var block_for_youtube= new RegExp(block_sites.join("|"), "i");


//Add Alternatives
vsc_keys.forEach(item => map(alt_key(item), item, block_for_vsc));
youtube_keys.forEach(item => map(alt_key(item), item));

//Remove Keys
vsc_keys.forEach(item => unmap(item, block_for_vsc));
youtube_keys.forEach(item => unmap(item, block_for_youtube));

//Vimium Like Keybindings
//Normal Tabs
map('J', 'E');
map('K', 'R');
//With Tree Style Tab
//map('J', 'R');
//map('K', 'E');
var j_k_character=0;

map('H', 'S');
map(';o', '<Ctrl-6>');
map('L', 'D');
map('F', 'gf');


//Tree Style Tab Shortcuts
unmap('e');

mapkey('ej', 'Move down current tab', () => {
    browser.runtime.sendMessage('treestyletab@piro.sakura.ne.jp', {
        type:           'move-down',
        tab:            'current',
        followChildren: false
    });
});

mapkey('eJ', 'Move down current tabs tree', () => {
    browser.runtime.sendMessage('treestyletab@piro.sakura.ne.jp', {
        type:           'move-down',
        tab:            'current',
        followChildren: true
    });
});

mapkey('ek', 'Move up current tab', () => {
    browser.runtime.sendMessage('treestyletab@piro.sakura.ne.jp', {
        type:           'move-up',
        tab:            'current',
        followChildren: false
    });
});

mapkey('eK', 'Move up current tabs tree', () => {
    browser.runtime.sendMessage('treestyletab@piro.sakura.ne.jp', {
        type:           'move-up',
        tab:            'current',
        followChildren: true
    });
});


mapkey('ez', 'Toggle tree collapse state', () => {
    //Call from root of tree
    browser.runtime.sendMessage('treestyletab@piro.sakura.ne.jp', {
          type: 'toggle-tree-collapsed',
          tab:  'active' // required, tabs.Tab.id or alias
    });
});

mapkey('el', 'Indent/Demote a tab', () => {
    browser.runtime.sendMessage('treestyletab@piro.sakura.ne.jp', {
        type:           'indent',
        tab:            'current',
        followChildren: false
    });
});

mapkey('eh', 'Outdent/Promote a tab', () => {
    browser.runtime.sendMessage('treestyletab@piro.sakura.ne.jp', {
        type:           'outdent',
        tab:            'current',
        followChildren: false
    });
});

mapkey('eL', 'Indent/Demote a tree', () => {
    browser.runtime.sendMessage('treestyletab@piro.sakura.ne.jp', {
        type:           'indent',
        tab:            'current',
        followChildren: true
    });
});

mapkey('eH', 'Outdent/Promote a tree', () => {
    browser.runtime.sendMessage('treestyletab@piro.sakura.ne.jp', {
        type:           'outdent',
        tab:            'current',
        followChildren: true
    });
});

/*
mapkey('er', 'Toggle J and K character', () => {
    
    if (j_k_character == 0){
        map('J', 'E');
        map('K', 'R');
        j_k_character = 1;
    }
    else{
        map('J', 'R');
        map('K', 'E');
        j_k_character = 0;
        
    }
});
*/


    //TV series go to next episode
   mapkey(';n', 'Go to next episode', 
    function next_episode(){
        base_url = window.location.href
        ep_no = base_url.match(/(\d+)(?!.*\d)/)[0]
        new_ep = parseInt(ep_no, 10) + 1;
        n = base_url.lastIndexOf(ep_no);
        new_url = base_url.slice(0, n) + base_url.slice(n).replace(ep_no, new_ep);
        window.location = new_url;
    }) ;
    
    //unmapAllExcept(['j','k','gf', 'J', 'K', 'H', 'L', 'yy', 'gg', 'G', 'gi', 'F', '<Ctrl-6>', 'X'], /youtube.com|dizibox.com|netflix.com/);
    //Theme
      Hints.style('border: solid 2px #373B41; color:#52C196; background: initial; background-color: #1D1F21;');
      Hints.style("border: solid 2px #373B41 !important; padding: 1px !important; color: #C5C8C6 !important; background: #1D1F21 !important;", "text");
      Visual.style('marks', 'background-color: #52C19699;');
      Visual.style('cursor', 'background-color: #81A2BE;');
      settings.theme = `
      /* Edit these variables for easy theme making */
      :root {
        /* Font */
        --font: 'Source Code Pro', Ubuntu, sans;
        --font-size: 12;
        --font-weight: bold;

        --fg: #C5C8C6;
        --bg: #282A2E;
        --bg-dark: #1D1F21;
        --border: #373b41;
        --main-fg: #81A2BE;
        --accent-fg: #52C196;
        --info-fg: #AC7BBA;
        --select: #585858;
         --cyan: #4CB3BC; 
         --orange: #DE935F;
         --red: #CC6666;
         --yellow: #CBCA77;

      }

      /* ---------- Generic ---------- */
      .sk_theme {
      background: var(--bg);
      color: var(--fg);
        background-color: var(--bg);
        border-color: var(--border);
        font-family: var(--font);
        font-size: var(--font-size);
        font-weight: var(--font-weight);
      }

      input {
        font-family: var(--font);
        font-weight: var(--font-weight);
      }

      .sk_theme tbody {
        color: var(--fg);
      }

      .sk_theme input {
        color: var(--fg);
      }

      /* Hints */
      #sk_hints .begin {
        color: var(--accent-fg) !important;
      }

      #sk_tabs .sk_tab {
        background: var(--bg-dark);
        border: 1px solid var(--border);
        color: var(--fg);
      }

      #sk_tabs .sk_tab_hint {
        background: var(--bg);
        border: 1px solid var(--border);
        color: var(--accent-fg);
      }

      .sk_theme #sk_frame {
        background: var(--bg);
        opacity: 0.2;
        color: var(--accent-fg);
      }

      /* ---------- Omnibar ---------- */
      /* Uncomment this and use settings.omnibarPosition = 'bottom' for Pentadactyl/Tridactyl style bottom bar */
      /* .sk_theme#sk_omnibar {
        width: 100%;
        left: 0;
      } */

      .sk_theme .title {
        color: var(--accent-fg);
      }

      .sk_theme .url {
        color: var(--main-fg);
      }

      .sk_theme .annotation {
        color: var(--accent-fg);
      }

      .sk_theme .omnibar_highlight {
        color: var(--accent-fg);
      }

      .sk_theme .omnibar_timestamp {
        color: var(--info-fg);
      }

      .sk_theme .omnibar_visitcount {
        color: var(--accent-fg);
      }

      .sk_theme #sk_omnibarSearchResult ul li:nth-child(odd) {
        background: var(--bg-dark);
      }

      .sk_theme #sk_omnibarSearchResult ul li.focused {
        background: var(--border);
      }

      .sk_theme #sk_omnibarSearchArea {
        border-top-color: var(--border);
        border-bottom-color: var(--border);
      }

      .sk_theme #sk_omnibarSearchArea input,
      .sk_theme #sk_omnibarSearchArea span {
        font-size: var(--font-size);
      }

      .sk_theme .separator {
        color: var(--accent-fg);
      }

      /* ---------- Popup Notification Banner ---------- */
      #sk_banner {
        font-family: var(--font);
        font-size: var(--font-size);
        font-weight: var(--font-weight);
        background: var(--bg);
        border-color: var(--border);
        color: var(--fg);
        opacity: 0.9;
      }

      /* ---------- Popup Keys ---------- */
      #sk_keystroke {
        background-color: var(--bg);
      }

      .sk_theme kbd .candidates {
        color: var(--info-fg);
      }

      .sk_theme span.annotation {
        color: var(--accent-fg);
      }

      /* ---------- Popup Translation Bubble ---------- */
      #sk_bubble {
        background-color: var(--bg) !important;
        color: var(--fg) !important;
        border-color: var(--border) !important;
      }

      #sk_bubble * {
        color: var(--fg) !important;
      }

      #sk_bubble div.sk_arrow div:nth-of-type(1) {
        border-top-color: var(--border) !important;
        border-bottom-color: var(--border) !important;
      }

      #sk_bubble div.sk_arrow div:nth-of-type(2) {
        border-top-color: var(--bg) !important;
        border-bottom-color: var(--bg) !important;
      }

      /* ---------- Search ---------- */
      #sk_status,
      #sk_find {
        font-size: var(--font-size);
        border-color: var(--border);
      }

      .sk_theme kbd {
        background: var(--bg-dark);
        border-color: var(--border);
        box-shadow: none;
        color: var(--fg);
      }

      .sk_theme .feature_name span {
        color: var(--main-fg);
      }

      /* ---------- ACE Editor ---------- */
      #sk_editor {
        background: var(--bg-dark) !important;
        height: 50% !important;
        /* Remove this to restore the default editor size */
      }

      .ace_dialog-bottom {
        border-top: 1px solid var(--bg) !important;
      }

      .ace-chrome .ace_print-margin,
      .ace_gutter,
      .ace_gutter-cell,
      .ace_dialog {
        background: var(--bg) !important;
      }

      .ace-chrome {
        color: var(--fg) !important;
      }

      .ace_gutter,
      .ace_dialog {
        color: var(--fg) !important;
      }

      .ace_cursor {
        color: var(--fg) !important;
      }

      .normal-mode .ace_cursor {
        background-color: var(--fg) !important;
        border: var(--fg) !important;
        opacity: 0.7 !important;
      }

      .ace_marker-layer .ace_selection {
        background: var(--select) !important;
      }

      .ace_editor,
      .ace_dialog span,
      .ace_dialog input {
        font-family: var(--font);
        font-size: var(--font-size);
        font-weight: var(--font-weight);
      }
      `;
      Hints.style("border: solid 2px #C38A22;padding: 1px;background: #e39913", "text");

      if (window.origin === "https://www.google.com") {
          function cyclegooglesuggestions(forward) {
              var suggestions = document.queryselectorall("ul>li.sbct");
              var selected = document.queryselector("ul>li.sbct.sbhl");
              var next;
              if (selected) {
                  selected.classlist.remove("sbhl");
                  var next = array.from(suggestions).indexof(selected) + (forward ? 1 : -1);
                  if (next === suggestions.length || next === -1) {
                      next = {innertext: window.userinput};
                  } else {
                      next = suggestions[next];
                      next.classlist.add("sbhl");
                  }
              } else {
                  window.userinput = document.queryselector("input.gsfi").value;
                  next = forward ? suggestions[0] : suggestions[suggestions.length - 1];
                  next.classlist.add("sbhl");
              }
              document.queryselector("input.gsfi").value = next.innertext;
          }
          imapkey('<ctrl-p>', 'cycle google suggestions', function () {
              cyclegooglesuggestions(false);
          });
          imapkey('<ctrl-n>', 'cycle google suggestions', function () {
              cyclegooglesuggestions(true);
          });
      }

*** Snap Links
** Tab++
*** Tree Style Tab
**** TST Bookmarks Subpanel
**** TST Colored Tabs
**** TST Mouse Wheel and Double Click
